$(document).ready(function(){function t(){n();var t=($("#realm").val(),$("#petName").val());""===t?$("#msg").html("宠物名不能为空"):e(t)}function e(t){$.get("wow/pet/name/"+t,function(e){if(201===e.code)$("#msg").html("查询宠物失败:"+e.errorMessage);else if(0===e.petSpeciesId)$("#msg").html("找不到宠物:"+t);else{BnadeLocalStorage.addItem(BnadeLocalStorage.lsItems.pet.key,t);var a=e.petSpeciesId,i="<p>该宠物有"+e.petStats.length+"种成长类型,请选择一种类型查找:</p>";i+="<table class='table table-striped'><thead><tr><th>#</th><th>ID</th><th>宠物名</th><th>成长类型</th><th>生命值</th><th>攻击</th><th>速度</th></tr></thead><tbody>";for(var n in e.petStats){var o=e.petStats[n];i+="<tr><td>"+(parseInt(n)+1)+"</td><td>"+a+"</td><td><a href='javascript:void(0)' id='petQuery"+n+"' petId='"+a+"' breed='"+o.breedId+"'>"+t+"</a></td><td>"+o.breedId+"</td><td>"+o.health+"</td><td>"+o.power+"</td><td>"+o.speed+"</td></tr>"}i+="</tbody></table>",$("#petResult").html(i);for(var n in e.petStats)$("#petQuery"+n).click(function(){l($(this).attr("petId"),$(this).attr("breed"),t)});var s=window.location.protocol+"//"+window.location.host+window.location.pathname+"?name="+encodeURIComponent(t);$("#queryByUrl").html("快速查询URL: <a href='"+s+"'>"+s+"</a>")}}).fail(function(){$("#msg").html("查询出错")})}function l(t,e,l){$("#msg").html("正在查询，请稍等..."),isShowAll=!0,$("#showAllTbl").hide(),$("#showAllA").html("所有服务器+"),a(t,e,l)}function a(t,e,l){$("#allRealmMsg").show(),$("#allRealmMsg").html("查询所有服务器数据,请稍等..."),$.get("wow/auction/pet/id/"+t+"/breed/"+e,function(t){if(404===t.code)$("#allRealmMsg").html("查询所有服务器失败:"+t.errorMessage),$("#allRealmCtlDiv").hide();else{var e=!0;$("#showAllA").click(function(){if(e){e=!1,$("#showAllTbl").show(),$("#showAllA").html("所有服务器-"),$("#showAllBody").empty();for(var l in t){var a=t[l],i=Bnade.getGold(a.minBuyout),n=Bnade.getConnectedRealms(a.realm);$("#showAllBody").append("<tr><td>"+(parseInt(l)+1)+"</td><td>"+n+"</td><td>"+i+"</td><td>"+a.minBuyoutOwner+"</td><td>"+a.petLevel+"</td><td>"+a.totalQuantity+"</td><td>"+new Date(a.lastModified).format("MM-dd hh:mm:ss")+"</td></tr>")}}else e=!0,$("#showAllTbl").hide(),$("#showAllA").html("所有服务器+")}),$("#allRealmMsg").html(""),$("#allRealmCtlDiv").show();var l=20,a=0,i=[],n=[],o=[],s=[],h=[],m=[],d=0;t.sort(function(t,e){return t.minBuyout-e.minBuyout});var r=0;for(var u in t){var c=t[u],p=c.realm,f=toDecimal(c.minBuyout/1e4);l>u&&(i[u]=p,n[u]=f,f>=10&&(n[u]=parseInt(f)),o[u]=c.totalQuantity),u>=.1*t.length&&u<=.9*t.length&&(a+=f,r++),d+=c.totalQuantity}d=parseInt(d/t.length),a=toDecimal(a/r),a>=10&&(a=parseInt(a));for(var v=0,g=0,y=[],u=t.length-1;u>0;u--){var c=t[u],f=toDecimal(c.minBuyout/1e4);3*a>f&&l>v&&(s[v]=c.realm,h[v]=f,f>=10&&(h[v]=parseInt(f)),m[v]=c.totalQuantity,v++),f>3*a&&(y[g++]=c)}$("#allRealmMsg").html("所有服务器平均价格:"+a),$("#allMinBuyout").html(n[0]),$("#allMaxBuyout").html(h[0]),$("#allAvgBuyout").html(a),$("#allAvgQuantity").html(d),$("#showAllA").click()}$("#msg").html("")})}function i(t,e){$.get("wow/pet/fuzzy/name/"+encodeURIComponent(e),function(t){if(201===t.code)$("#msg").html("模糊查询失败:"+t.errorMessage);else if(0===t.length)$("#msg").html("找不到物品:"+$("#petName").val());else{$("#fuzzyItemsList").show(),$("#fuzzyItemsList").html("<li class='active'><a href='javascript:void(0)'>物品名</a></li>");for(var e in t){var l="fuzzyItem"+e;$("#fuzzyItemsList").append("<li><a href='javascript:void(0)' id='"+l+"'>"+t[e]+"</a></li>"),$("#"+l).click(function(){$("#petName").val($(this).html()),$("#queryBtn").click()})}$("#msg").html("")}}).fail(function(){$("#msg").html("查询出错")})}function n(){$("#past24CtlDiv").hide(),$("#past24Msg").hide(),$("#pastWeekCtlDiv").hide(),$("#pastWeekMsg").hide(),$("#allRealmCtlDiv").hide(),$("#allRealmMsg").hide(),$("#fuzzyItemsTbl").hide()}function o(){var t=getUrlParam("name");null!==t&&""!==t&&($("#petName").val(t),$("#queryBtn").click())}$("#queryBtn").click(function(){t()}),$("#fuzzyQueryBtn").click(function(){var t=$("#realm").val(),e=$("#petName").val();""===e?$("#msg").html("宠物名不能为空"):($("#msg").html("正在查询，请稍等..."),$("#pastWeekMsg").html(""),$("#allRealmMsg").html(""),i(t,e))}),!function(){$("#past24CtlDiv").hide(),$("#pastWeekCtlDiv").hide(),$("#allRealmCtlDiv").hide(),$("#fuzzyItemsTbl").hide(),o()}()});